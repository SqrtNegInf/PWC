#!/usr/bin/env raku
## run weekly challenge code for a specific task and language
# 2022-02-02 initial version

sub MAIN ( Int $ch,
           Int $task       where { $task == 1|2 },
           Str $lang       where { $lang eq 'raku'|'perl' } ) {

my $ext = $lang eq 'raku' ?? 'raku' !! 'pl';

if $lang eq 'raku' {

my $prefix-m = "$ch/$task/00-{$lang}-moar";
my $prefix-j = "$ch/$task/00-{$lang}-jvm";

shell qq:to/END/;
rakudobrew switch moar-blead
find $ch/$task -name '*$ext' -exec echo ' ' \\; -exec echo "===> \{\} <===" \\; -execdir raku    -I lib \{\} \\; > $prefix-m.txt 2> $prefix-m.err
rakudobrew switch jvm-2021.12
find $ch/$task -name '*$ext' -exec echo ' ' \\; -exec echo "===> \{\} <===" \\; -execdir perl6-j -I lib \{\} \\; > $prefix-j.txt 2> $prefix-j.err
rakudobrew switch moar-blead
END

.IO.unlink if .IO.e and ! .IO.s for ("{$prefix-m}.err", "{$prefix-j}.err");

} else {

my $prefix = "$ch/$task/00-{$lang}";

shell qq:to/END/;
find $ch/$task -name '*$ext' -exec echo ' ' \\; -exec echo "===> \{\} <===" \\; -execdir perl \{\} \\; > $prefix.txt 2> $prefix.err
END

.IO.unlink if .IO.e and ! .IO.s for "{$prefix}.err", "{$prefix}.err";

}

}
